# adhoc_close_tests: adhoc tests to check behaviour of close in various situations
#
# initialization
OS_CALL(Pid 1,mkdir /tmp_dir_0/ 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/empty_dir1 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/empty_dir2 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir1 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir1/f2.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,pwrite /tmp_dir_0/d1/nonempty_dir1/f2.txt 0 "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit an" 875)
Int1(875)
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir1/d2 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir1/d2/f3.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,pwrite /tmp_dir_0/d1/nonempty_dir1/d2/f3.txt 0 "Lorem ipsum dolor sit a" 23)
Int1(23)
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir1/d2/f4.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,pwrite /tmp_dir_0/d1/nonempty_dir1/d2/f4.txt 0 "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse " 2978)
Int1(2978)
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir1/d2/d3 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir1/d2/d4 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir2 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir2/f1.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir2/f2.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,pwrite /tmp_dir_0/d1/nonempty_dir2/f2.txt 0 "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidat" 367)
Int1(367)
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir2/d2 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir2/d2/f3.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,open_close /tmp_dir_0/d1/nonempty_dir2/d2/f4.txt [O_RDWR;O_CREAT] 0o000)
None1
OS_CALL(Pid 1,pwrite /tmp_dir_0/d1/nonempty_dir2/d2/f4.txt 0 "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis" 4177)
Int1(4177)
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir2/d2/d3 0o000)
None1
OS_CALL(Pid 1,mkdir /tmp_dir_0/d1/nonempty_dir2/d2/d4 0o000)
None1
#
# close on an fd that was never used
OS_CALL(Pid 1,close (FD 3))
[EBADF]
# and again
OS_CALL(Pid 1,close (FD 4))
[EBADF]
#
# open a normal file, and close
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,close (FD 3))
None1
#
# open a normal file, and close twice
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,close (FD 3))
None1
OS_CALL(Pid 1,close (FD 3))
[EBADF]
#
# open and close a recently closed fd
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,close (FD 3))
None1
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,close (FD 3))
None1
#
# multiple overlapping opens
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f2.txt [O_RDWR] 0o000)
Int1(4)
OS_CALL(Pid 1,close (FD 3))
None1
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(3)
OS_CALL(Pid 1,close (FD 4))
None1
OS_CALL(Pid 1,close (FD 3))
None1
#
# opening a directory
OS_CALL(Pid 1,open /tmp_dir_0/d1 [O_RDWR] 0o000)
[EISDIR]
OS_CALL(Pid 1,close (FD 3))
[EBADF]
OS_CALL(Pid 1,open /tmp_dir_0/d1/ [O_RDWR] 0o000)
[EISDIR]
OS_CALL(Pid 1,close (FD 3))
[EBADF]
#
# closing stdin, stdout and stderr
OS_CALL(Pid 1,close (FD 0))
None1
# FIXME we can't close stdout because we are using it to return results of tests!
#close (FD 1)
# FIXME we probably shouldn't close stderr either
OS_CALL(Pid 1,close (FD 2))
None1
OS_CALL(Pid 1,open /tmp_dir_0/d1/nonempty_dir1/f1.txt [O_RDWR] 0o000)
Int1(0)
OS_CALL(Pid 1,close (FD 0))
None1
